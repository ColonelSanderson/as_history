<%= stylesheet_link_tag "#{AppConfig[:frontend_prefix]}assets/history.css" %>

<%
  history_uri = false
  unless action_name == 'new'
    [
     @repository,
     @archival_object,
     @resource,
     @digital_object_component,
     @digital_object,
     @accession,
     @agent
    ].each do |obj|
      if obj
        if obj.respond_to?(:history)
          history_uri = obj.history['ref']
          break
        elsif obj.respond_to?(:repository) && obj.repository.has_key?('history')
          history_uri = obj.repository['history']['ref']
          break
        end
      end
    end
  end
%>

<% if controller.action_name == 'show' && history_uri %>
  <meta name="history_uri" content="<%= history_uri %>">
  <script>
    // for resources - sigh
    $(window).on("loadedrecordform.aspace", function() {
      $('#archivesSpaceSidebar').append('<%=j render partial: 'history/button', :locals => {:uri => history_uri} %>');
    });
    // for the other record types - sigh
    $(function() {
    if (!$('#as-history-button').length) {
        $('#archivesSpaceSidebar').append('<%=j render partial: 'history/button', :locals => {:uri => history_uri} %>');
    }
    });
  </script>
<% end %>
