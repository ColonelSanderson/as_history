<%
  link_hash = {:controller => model_pl, :action => :show}
  link_hash[:agent_type] = data['model'] if model_pl == 'agents'

  if data['model'] == 'archival_object' && json.has_key?('resource')
    link_hash[:id] = json['resource']['ref'].split('/')[-2]
    link_hash[:anchor] = "tree::archival_object_#{data['record_id']}"
  end

  breadcrumb_trail = [[model_pl.capitalize, {:controller => model_pl, :action => :index}],
                      [json['name'] || json['display_string'] || json['title'], {:id => data['record_id']}.merge(link_hash)],
                      [t('plugins.history.button_label')]]
%>

<% record_title = json['name'] || json['display_string'] || json['title'] %>

<div class="row">
  <div class="col-md-12 history-title-bar">
    <div class="history-current-set-pane">
      <%= link_to '<span class="glyphicon glyphicon-chevron-left"></span>'.html_safe ,
                  {:id => data['record_id']}.merge(link_hash),
                  {:title => 'Return to live record', :class => 'btn btn-default history-exit'} %>

      <a class="btn btn-default history-version-set"
         onclick="$('.history-browse-select-pane').slideToggle();">

        <%= params['id'] ? "#{params['model']} / #{params['id']} #{record_title ? ' -- ' + record_title : ''}" : 'Recent updates' %>
        <%= " by #{params['user']}" if params['user'] %>

        <span style="vertical-align:middle;" class="caret"></span>
      </a>
    </div>


    <div class="history-previous-sets-pane">
      <a style="display:none"
         id="history-previous-version-set-template"
         class="btn btn-default history-previous-version-set"
         href=" ">
        Moo
      </a>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <%= render_aspace_partial :partial => "history/browse_dialog" %>
  </div>
</div>


<div class="row">

  <div class="col-md-3">
    <%= render_aspace_partial :partial => "history/sidebar" %>
  </div>

  <div class="col-md-9 as-history-main-pane">

    <%= render_aspace_partial :partial => "history/toolbar" %>

    <div class="record-pane history-record-pane">
      <%= render_aspace_partial :partial => "history/audit_dialog", :locals => {:current_version => @version['versions'].values.first['lock_version']} %>
      <%= render_aspace_partial :partial => "history/restore_dialog", :locals => {:current_version => @version['versions'].values.first['lock_version']} %>
      <%= render_aspace_partial :partial => "shared/flash_messages" %>

      <%= render_aspace_partial :partial => "history/record", :locals => {:json => json, :diff => @version['diff'], :top => true} %>
    </div>

  </div>

</div>
